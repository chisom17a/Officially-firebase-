<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin â€“ Activation Requests</title>

<style>
  body {
    font-family: Poppins, sans-serif;
    background: #f1f5f9;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  .request {
    background: white;
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 18px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }

  .request img {
    width: 100%;
    max-height: 300px;
    object-fit: contain;
    border-radius: 10px;
    margin-top: 10px;
  }

  .actions {
    display: flex;
    gap: 12px;
    margin-top: 15px;
  }

  button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
  }

  .approve {
    background: #22c55e;
    color: white;
  }

  .reject {
    background: #ef4444;
    color: white;
  }

  .empty {
    text-align: center;
    color: #64748b;
    margin-top: 50px;
  }
</style>
</head>

<body>

<h1>Activation Requests</h1>

<div id="requestsContainer"></div>

<script>
/* ---------------- AUTH CHECK ---------------- */
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
const users = JSON.parse(localStorage.getItem("users")) || [];

if (!currentUser) {
  alert("Not logged in");
  window.location.href = "login.html";
}

const admin = users.find(u => u.email === currentUser.email);

if (!admin || admin.model !== "Admin") {
  alert("Unauthorized access");
  window.location.href = "login.html";
}

/* ---------------- LOAD REQUESTS ---------------- */
let requests = JSON.parse(localStorage.getItem("activationRequests")) || [];
const container = document.getElementById("requestsContainer");

if (requests.length === 0) {
  container.innerHTML = `<div class="empty">No activation requests</div>`;
}

/* ---------------- RENDER ---------------- */
requests.forEach((req, index) => {
  const div = document.createElement("div");
  div.className = "request";

  div.innerHTML = `
    <p><b>Email:</b> ${req.email}</p>
    <p><b>Sender Name:</b> ${req.senderName}</p>
    <p><b>Time:</b> ${req.timestamp}</p>

    ${req.image ? `<img src="${req.image}">` : `<p>No proof uploaded</p>`}

    <div class="actions">
      <button class="approve" onclick="approve(${index})">Approve</button>
      <button class="reject" onclick="reject(${index})">Reject</button>
    </div>
  `;

  container.appendChild(div);
});

/* ---------------- ACTIONS ---------------- */
function approve(index) {
  processRequest(index, true);
}

function reject(index) {
  processRequest(index, false);
}

function processRequest(index, isApproved) {
  const req = requests[index];
  let users = JSON.parse(localStorage.getItem("users")) || [];

  const user = users.find(u => u.email === req.email);

  if (!user) {
    alert("User not found");
    return;
  }

  user.activated = isApproved;
  user.activationStatus = isApproved ? "approved" : "rejected";

  // Save users
  localStorage.setItem("users", JSON.stringify(users));

  // Remove request
  requests.splice(index, 1);
  localStorage.setItem("activationRequests", JSON.stringify(requests));

  alert(isApproved ? "Account activated" : "Activation rejected");
  location.reload();
}
</script>

</body>
</html>